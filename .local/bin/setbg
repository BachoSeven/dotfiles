#!/bin/bash

# This script sets the background image, using pywal to set a terminal colorscheme,or otherwise
# using Xresources with xwallpaper.

#	Usage:
#		`setbg [ -s, --no-scheme ] [ -i, --input="path/to/img" ]`

bgloc=$XDG_CONFIG_HOME/wall.png


TEMP=$(getopt -o 'si:' --long 'no-scheme,input:' -- "$@" )

eval set -- "$TEMP"
unset TEMP

scheme=true

while true; do
	case "$1" in
		'-s'|'--no-scheme')
			scheme=false
			shift
			continue
		;;
		'-i'|'--input')
			[ -n $2 ] && cp "$2" $bgloc > /dev/null 2>&1 && notify-send -i "$bgloc" "Wallpaper changed."
			if [ $scheme = true ]; then
				wal -i $bgloc && wal -c && vimwal -w
			else
				xrdb -load $HOME/.Xresources && vimwal -x
			fi
			shift 2
			continue
		;;
		'--')
			shift
			break
		;;
		*)
			echo 'Error!' >&2
			exit 1
		;;
	esac
done

# Use gifview for gifs, otherwise xwallpaper
killall -q xwinwrap 2>/dev/null ; [[ ! $(file --dereference --brief --mime-type -- $bgloc) = "image/gif"  ]] && xwallpaper --maximize "$bgloc" || hsetroot -solid "#282828" & gifbg "$bgloc"
